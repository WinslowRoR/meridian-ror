-- Generated by ProvEdit version 0.1 --
local STAGE_INFO = {
    name = "Coral Depths",
    subname = "Below the Tomb",
    width = 3488,
    height = 1728,
    music = ":nothing:"
}

local STAGE_LAYERS = {
    {
        depth = 12,
        sprite = "CR_4_1_tileset",
        origin = "RoRMaps",
        tiles = {
            [20] = {
                [94] = {1,0}, 
            },
            [195] = {
                [101] = {2,0}, [54] = {1,3}, [47] = {3,0}, 
            },
            [26] = {
                [43] = {2,0}, [94] = {2,0}, [49] = {1,3}, 
            },
            [147] = {
                [30] = {3,3}, [84] = {2,0}, [17] = {1,0}, [54] = {1,3}, [46] = {3,0}, 
            },
            [190] = {
                [74] = {3,0}, [102] = {3,0}, [54] = {1,3}, [75] = {3,3}, [47] = {1,0}, 
            },
            [203] = {
                [48] = {1,0}, [101] = {1,0}, [55] = {1,3}, 
            },
            [149] = {
                [30] = {4,3}, [84] = {1,0}, [53] = {1,3}, [17] = {1,0}, [46] = {3,0}, 
            },
            [160] = {
                [84] = {1,0}, [53] = {1,3}, [45] = {3,0}, 
            },
            [198] = {
                [48] = {2,0}, [101] = {3,0}, [54] = {2,3}, 
            },
            [211] = {
                [55] = {3,3}, [47] = {2,0}, 
            },
            [143] = {
                [30] = {1,3}, [17] = {1,0}, [54] = {3,3}, [46] = {1,0}, [85] = {3,0}, 
            },
            [206] = {
                [107] = {4,2}, [48] = {3,0}, [106] = {4,2}, [102] = {4,2}, [105] = {4,1}, [101] = {4,0}, [104] = {4,1}, [55] = {3,3}, [103] = {4,1}, 
            },
            [145] = {
                [30] = {1,3}, [84] = {0,0}, [17] = {2,0}, [54] = {3,3}, [46] = {2,0}, [85] = {1,0}, 
            },
            [161] = {
                [84] = {3,0}, [53] = {2,3}, [45] = {2,0}, 
            },
            [214] = {
                [54] = {1,3}, [42] = {3,0}, 
            },
            [135] = {
                [45] = {0,0}, [54] = {3,3}, [46] = {3,0}, [85] = {3,0}, [31] = {1,3}, [18] = {2,0}, 
            },
            [139] = {
                [45] = {2,0}, [54] = {1,3}, [85] = {1,0}, [31] = {3,3}, [18] = {1,0}, 
            },
            [159] = {
                [84] = {1,0}, [53] = {3,3}, [45] = {0,0}, [46] = {2,0}, 
            },
            [127] = {
                [30] = {1,3}, [46] = {3,0}, [18] = {3,0}, [55] = {3,3}, [91] = {3,0}, 
            },
            [131] = {
                [86] = {0,2}, [90] = {0,2}, [88] = {0,1}, [54] = {3,3}, [46] = {3,0}, [85] = {0,0}, [31] = {1,3}, [89] = {0,2}, [87] = {0,1}, [18] = {2,0}, [91] = {3,0}, 
            },
            [21] = {
                [94] = {1,0}, 
            },
            [121] = {
                [56] = {2,3}, [30] = {3,3}, [46] = {2,0}, [18] = {3,0}, [92] = {1,0}, [91] = {0,0}, 
            },
            [23] = {
                [94] = {1,0}, 
            },
            [169] = {
                [73] = {1,0}, [74] = {3,0}, [54] = {2,3}, [46] = {1,0}, 
            },
            [126] = {
                [30] = {1,3}, [46] = {1,0}, [18] = {3,0}, [55] = {3,3}, [91] = {2,0}, 
            },
            [113] = {
                [94] = {0,1}, [74] = {1,3}, [97] = {1,0}, [93] = {0,2}, [71] = {3,0}, [96] = {0,1}, [92] = {0,0}, [95] = {0,2}, 
            },
            [156] = {
                [84] = {2,0}, [53] = {3,3}, [17] = {1,0}, [46] = {3,0}, [29] = {1,3}, 
            },
            [167] = {
                [73] = {1,0}, [74] = {1,0}, [45] = {4,0}, [54] = {3,3}, [46] = {2,0}, 
            },
            [118] = {
                [73] = {1,3}, [71] = {2,0}, [92] = {1,0}, 
            },
            [105] = {
                [44] = {2,0}, [102] = {1,0}, [57] = {2,3}, [71] = {1,0}, [75] = {1,3}, 
            },
            [173] = {
                [73] = {1,0}, [74] = {3,0}, [53] = {3,3}, [46] = {2,0}, 
            },
            [110] = {
                [74] = {1,3}, [97] = {2,0}, [71] = {2,0}, 
            },
            [97] = {
                [44] = {2,0}, [22] = {3,3}, [19] = {1,0}, 
            },
            [155] = {
                [84] = {1,0}, [53] = {3,3}, [17] = {3,0}, [46] = {2,0}, [29] = {2,3}, 
            },
            [171] = {
                [73] = {2,0}, [74] = {3,0}, [54] = {2,3}, [46] = {3,0}, 
            },
            [102] = {
                [64] = {4,1}, [77] = {4,2}, [66] = {4,1}, [60] = {4,2}, [78] = {4,2}, [62] = {4,2}, [76] = {4,1}, [44] = {1,0}, [80] = {4,1}, [79] = {4,2}, [57] = {2,3}, [82] = {2,0}, [81] = {4,2}, [70] = {4,1}, [71] = {3,0}, [68] = {4,1}, [69] = {4,1}, [65] = {4,1}, [67] = {4,1}, [61] = {4,2}, 
                [63] = {4,2}, [58] = {4,1}, [59] = {4,2}, 
            },
            [85] = {
                [27] = {4,1}, [19] = {3,0}, [28] = {4,1}, [25] = {4,1}, [26] = {4,2}, [18] = {4,0}, [29] = {4,1}, [24] = {4,1}, 
            },
            [80] = {
                [18] = {1,0}, 
            },
            [181] = {
                [76] = {2,3}, [90] = {3,0}, [74] = {2,0}, [102] = {2,0}, [53] = {3,3}, [47] = {2,0}, [91] = {3,3}, 
            },
            [91] = {
                [44] = {3,0}, [19] = {2,0}, [23] = {1,3}, 
            },
            [90] = {
                [44] = {3,0}, [19] = {2,0}, [23] = {1,3}, 
            },
            [69] = {
                [44] = {3,0}, [23] = {3,0}, [26] = {1,3}, 
            },
            [64] = {
                [77] = {2,3}, [52] = {2,3}, [44] = {3,0}, [71] = {3,0}, [93] = {2,0}, [23] = {3,0}, [26] = {2,3}, 
            },
            [157] = {
                [84] = {1,0}, [53] = {3,3}, [28] = {4,2}, [17] = {4,0}, [46] = {1,0}, [29] = {4,3}, 
            },
            [177] = {
                [86] = {4,2}, [84] = {4,2}, [90] = {1,0}, [88] = {4,2}, [98] = {4,2}, [94] = {4,1}, [74] = {3,0}, [102] = {2,0}, [80] = {4,2}, [53] = {3,3}, [79] = {4,2}, [82] = {4,2}, [81] = {4,1}, [97] = {4,2}, [93] = {4,1}, [101] = {4,1}, [46] = {1,0}, [85] = {4,1}, [83] = {4,2}, [89] = {4,1}, 
                [87] = {4,2}, [96] = {4,1}, [92] = {4,1}, [100] = {4,2}, [95] = {4,2}, [91] = {2,3}, [99] = {4,2}, 
            },
            [75] = {
                [18] = {1,0}, 
            },
            [74] = {
                [18] = {2,0}, 
            },
            [53] = {
                [77] = {1,3}, [52] = {1,3}, [44] = {1,0}, [71] = {1,0}, [93] = {2,0}, 
            },
            [48] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {3,0}, [71] = {2,0}, [93] = {2,0}, 
            },
            [189] = {
                [74] = {3,0}, [102] = {1,0}, [54] = {2,3}, [75] = {3,3}, [47] = {1,0}, 
            },
            [59] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {1,0}, [25] = {0,1}, [71] = {1,0}, [93] = {1,0}, [23] = {0,0}, [26] = {0,3}, [24] = {0,2}, 
            },
            [58] = {
                [77] = {2,3}, [52] = {2,3}, [44] = {1,0}, [71] = {3,0}, [93] = {2,0}, 
            },
            [37] = {
                [77] = {1,3}, [43] = {1,0}, [72] = {2,0}, [94] = {3,0}, [50] = {1,3}, 
            },
            [32] = {
                [77] = {1,3}, [43] = {3,0}, [72] = {1,0}, [94] = {2,0}, [49] = {1,3}, 
            },
            [185] = {
                [76] = {4,3}, [90] = {4,0}, [74] = {1,0}, [102] = {2,0}, [53] = {3,3}, [47] = {1,0}, [91] = {4,3}, 
            },
            [43] = {
                [77] = {2,3}, [43] = {2,0}, [72] = {2,0}, [94] = {2,0}, [51] = {1,3}, 
            },
            [42] = {
                [77] = {2,3}, [43] = {1,0}, [72] = {2,0}, [94] = {1,0}, [51] = {1,3}, 
            },
            [197] = {
                [48] = {1,0}, [101] = {3,0}, [54] = {3,3}, 
            },
            [28] = {
                [43] = {2,0}, [94] = {1,0}, [49] = {1,3}, 
            },
            [192] = {
                [102] = {2,0}, [54] = {1,3}, [47] = {2,0}, 
            },
            [205] = {
                [48] = {2,0}, [101] = {1,0}, [55] = {2,3}, 
            },
            [200] = {
                [48] = {2,0}, [101] = {2,0}, [55] = {0,3}, 
            },
            [213] = {
                [44] = {0,1}, [43] = {0,1}, [45] = {0,2}, [54] = {2,3}, [46] = {3,0}, [42] = {0,0}, 
            },
            [208] = {
                [48] = {2,0}, [55] = {2,3}, [47] = {0,0}, 
            },
            [216] = {
                [54] = {2,3}, [34] = {1,0}, 
            },
            [136] = {
                [45] = {3,0}, [54] = {1,3}, [85] = {2,0}, [31] = {3,3}, [18] = {2,0}, 
            },
            [163] = {
                [74] = {3,0}, [53] = {3,3}, [45] = {1,0}, 
            },
            [140] = {
                [45] = {2,0}, [17] = {0,0}, [54] = {2,3}, [85] = {3,0}, [31] = {2,3}, 
            },
            [162] = {
                [77] = {0,1}, [78] = {0,1}, [76] = {0,1}, [84] = {1,0}, [74] = {0,0}, [80] = {0,1}, [53] = {3,3}, [79] = {0,2}, [82] = {0,2}, [45] = {3,0}, [81] = {0,2}, [75] = {0,1}, [83] = {0,1}, 
            },
            [128] = {
                [46] = {1,0}, [31] = {0,3}, [18] = {1,0}, [55] = {3,3}, [91] = {1,0}, 
            },
            [165] = {
                [73] = {1,0}, [74] = {3,0}, [53] = {2,3}, [45] = {3,0}, 
            },
            [132] = {
                [54] = {1,3}, [46] = {3,0}, [85] = {3,0}, [31] = {1,3}, [18] = {3,0}, 
            },
            [164] = {
                [73] = {0,0}, [74] = {3,0}, [53] = {3,3}, [45] = {2,0}, 
            },
            [119] = {
                [52] = {0,2}, [56] = {0,3}, [48] = {0,1}, [73] = {4,3}, [22] = {0,2}, [72] = {4,1}, [19] = {0,2}, [53] = {0,2}, [49] = {0,2}, [20] = {0,1}, [71] = {4,0}, [54] = {0,1}, [46] = {0,0}, [50] = {0,1}, [23] = {0,3}, [18] = {0,0}, [92] = {3,0}, [55] = {0,2}, [47] = {0,1}, [51] = {0,2}, 
                [21] = {0,1}, 
            },
            [29] = {
                [43] = {2,0}, [94] = {3,0}, [49] = {1,3}, 
            },
            [124] = {
                [30] = {2,3}, [46] = {2,0}, [18] = {3,0}, [55] = {2,3}, [91] = {1,0}, 
            },
            [111] = {
                [74] = {1,3}, [97] = {2,0}, [71] = {2,0}, 
            },
            [116] = {
                [73] = {1,3}, [71] = {3,0}, [92] = {3,0}, 
            },
            [103] = {
                [44] = {1,0}, [86] = {4,2}, [84] = {4,2}, [90] = {4,2}, [88] = {4,2}, [57] = {1,3}, [82] = {4,0}, [71] = {2,0}, [75] = {2,3}, [85] = {4,2}, [83] = {4,1}, [89] = {4,2}, [87] = {4,1}, [91] = {2,0}, 
            },
            [108] = {
                [44] = {4,0}, [48] = {4,2}, [74] = {1,3}, [102] = {2,0}, [45] = {4,2}, [49] = {4,1}, [71] = {1,0}, [46] = {4,2}, [50] = {4,3}, [47] = {4,2}, 
            },
            [95] = {
                [44] = {1,0}, [22] = {3,3}, [19] = {3,0}, 
            },
            [100] = {
                [44] = {2,0}, [22] = {3,3}, [19] = {2,0}, 
            },
            [84] = {
                [18] = {2,0}, 
            },
            [81] = {
                [18] = {2,0}, 
            },
            [94] = {
                [44] = {1,0}, [22] = {2,3}, [19] = {3,0}, 
            },
            [153] = {
                [84] = {2,0}, [53] = {2,3}, [17] = {2,0}, [46] = {2,0}, [29] = {1,3}, 
            },
            [180] = {
                [77] = {4,3}, [90] = {3,0}, [74] = {3,0}, [102] = {1,0}, [53] = {3,3}, [46] = {4,0}, [47] = {2,0}, [91] = {1,3}, 
            },
            [87] = {
                [43] = {4,0}, [19] = {1,0}, [23] = {1,3}, 
            },
            [68] = {
                [44] = {3,0}, [23] = {1,0}, [26] = {1,3}, 
            },
            [65] = {
                [77] = {3,3}, [52] = {2,3}, [44] = {2,0}, [86] = {0,0}, [90] = {0,1}, [88] = {0,1}, [71] = {3,0}, [89] = {0,2}, [23] = {1,0}, [26] = {1,3}, [87] = {0,2}, [92] = {0,1}, [91] = {0,1}, 
            },
            [78] = {
                [18] = {2,0}, 
            },
            [154] = {
                [84] = {3,0}, [53] = {1,3}, [17] = {3,0}, [46] = {2,0}, [29] = {1,3}, 
            },
            [176] = {
                [74] = {2,0}, [53] = {1,3}, [46] = {3,0}, 
            },
            [71] = {
                [38] = {0,2}, [43] = {0,1}, [35] = {0,2}, [36] = {0,1}, [41] = {0,2}, [39] = {0,1}, [42] = {0,2}, [34] = {0,0}, [23] = {3,0}, [26] = {2,3}, [37] = {0,2}, [40] = {0,2}, 
            },
            [52] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {1,0}, [71] = {3,0}, [93] = {1,0}, 
            },
            [49] = {
                [77] = {3,3}, [52] = {1,3}, [44] = {2,0}, [71] = {1,0}, [93] = {1,0}, 
            },
            [62] = {
                [77] = {2,3}, [52] = {2,3}, [44] = {1,0}, [71] = {2,0}, [93] = {1,0}, [23] = {2,0}, [26] = {3,3}, 
            },
            [151] = {
                [84] = {3,0}, [53] = {1,3}, [17] = {2,0}, [46] = {1,0}, [29] = {1,3}, 
            },
            [188] = {
                [74] = {3,0}, [102] = {1,0}, [54] = {3,3}, [75] = {1,3}, [47] = {2,0}, 
            },
            [55] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {1,0}, [71] = {1,0}, [93] = {2,0}, 
            },
            [36] = {
                [77] = {3,3}, [43] = {3,0}, [72] = {2,0}, [94] = {3,0}, [50] = {1,3}, 
            },
            [33] = {
                [77] = {3,3}, [43] = {3,0}, [72] = {1,0}, [94] = {2,0}, [50] = {0,3}, 
            },
            [46] = {
                [77] = {1,3}, [52] = {3,3}, [44] = {1,0}, [72] = {1,0}, [94] = {1,0}, 
            },
            [152] = {
                [84] = {1,0}, [53] = {1,3}, [17] = {2,0}, [46] = {2,0}, [29] = {2,3}, 
            },
            [184] = {
                [76] = {3,3}, [90] = {3,0}, [74] = {1,0}, [102] = {1,0}, [53] = {1,3}, [47] = {1,0}, [91] = {3,3}, 
            },
            [39] = {
                [77] = {2,3}, [43] = {2,0}, [72] = {3,0}, [94] = {1,0}, [50] = {3,3}, 
            },
            [148] = {
                [30] = {1,3}, [84] = {2,0}, [17] = {3,0}, [54] = {4,3}, [46] = {1,0}, 
            },
            [194] = {
                [102] = {2,0}, [101] = {0,0}, [54] = {2,3}, [47] = {2,0}, 
            },
            [30] = {
                [77] = {0,3}, [76] = {0,2}, [43] = {2,0}, [73] = {0,2}, [72] = {0,0}, [74] = {0,1}, [94] = {2,0}, [49] = {2,3}, [75] = {0,1}, 
            },
            [191] = {
                [74] = {4,0}, [102] = {1,0}, [54] = {2,3}, [75] = {4,3}, [47] = {3,0}, 
            },
            [150] = {
                [84] = {3,0}, [53] = {3,3}, [17] = {2,0}, [46] = {3,0}, [29] = {1,3}, 
            },
            [202] = {
                [48] = {2,0}, [101] = {1,0}, [55] = {1,3}, 
            },
            [199] = {
                [48] = {2,0}, [101] = {1,0}, [54] = {3,3}, 
            },
            [144] = {
                [30] = {2,3}, [17] = {2,0}, [54] = {2,3}, [46] = {2,0}, [85] = {3,0}, 
            },
            [210] = {
                [55] = {1,3}, [47] = {2,0}, 
            },
            [207] = {
                [48] = {3,0}, [55] = {3,3}, 
            },
            [146] = {
                [30] = {3,3}, [84] = {1,0}, [17] = {3,0}, [54] = {1,3}, [46] = {1,0}, 
            },
            [215] = {
                [38] = {0,1}, [35] = {0,1}, [36] = {0,2}, [41] = {0,2}, [54] = {2,3}, [39] = {0,1}, [42] = {2,0}, [34] = {0,0}, [37] = {0,2}, [40] = {0,1}, 
            },
            [137] = {
                [45] = {3,0}, [54] = {1,3}, [85] = {2,0}, [31] = {2,3}, [18] = {3,0}, 
            },
            [141] = {
                [45] = {4,0}, [17] = {3,0}, [54] = {2,3}, [46] = {2,0}, [85] = {3,0}, [31] = {4,3}, 
            },
            [158] = {
                [84] = {1,0}, [22] = {4,1}, [27] = {4,3}, [19] = {4,2}, [53] = {1,3}, [20] = {4,1}, [25] = {4,2}, [46] = {2,0}, [23] = {4,2}, [26] = {4,1}, [18] = {4,0}, [21] = {4,2}, [24] = {4,2}, 
            },
            [129] = {
                [46] = {3,0}, [31] = {1,3}, [18] = {1,0}, [55] = {4,3}, [91] = {1,0}, 
            },
            [133] = {
                [54] = {2,3}, [46] = {1,0}, [85] = {3,0}, [31] = {2,3}, [18] = {2,0}, 
            },
            [168] = {
                [73] = {3,0}, [74] = {1,0}, [54] = {3,3}, [46] = {1,0}, 
            },
            [122] = {
                [56] = {4,3}, [30] = {1,3}, [46] = {1,0}, [18] = {3,0}, [91] = {1,0}, 
            },
            [27] = {
                [43] = {3,0}, [94] = {1,0}, [49] = {2,3}, 
            },
            [125] = {
                [30] = {3,3}, [46] = {3,0}, [18] = {3,0}, [55] = {3,3}, [91] = {1,0}, 
            },
            [166] = {
                [73] = {1,0}, [74] = {2,0}, [45] = {1,0}, [54] = {0,3}, 
            },
            [114] = {
                [74] = {2,3}, [71] = {1,0}, [92] = {3,0}, 
            },
            [117] = {
                [73] = {3,3}, [71] = {2,0}, [92] = {1,0}, 
            },
            [172] = {
                [73] = {3,0}, [74] = {3,0}, [54] = {4,3}, [46] = {2,0}, 
            },
            [106] = {
                [44] = {2,0}, [102] = {2,0}, [57] = {1,3}, [71] = {2,0}, [75] = {4,3}, 
            },
            [109] = {
                [98] = {0,2}, [74] = {1,3}, [102] = {2,0}, [97] = {0,0}, [71] = {1,0}, [101] = {0,2}, [100] = {0,2}, [99] = {0,2}, 
            },
            [170] = {
                [73] = {3,0}, [74] = {3,0}, [54] = {3,3}, [46] = {1,0}, 
            },
            [98] = {
                [44] = {2,0}, [22] = {3,3}, [19] = {1,0}, 
            },
            [101] = {
                [44] = {3,0}, [22] = {4,3}, [19] = {4,0}, [20] = {4,1}, [21] = {4,1}, 
            },
            [179] = {
                [77] = {3,3}, [90] = {3,0}, [74] = {3,0}, [102] = {1,0}, [53] = {3,3}, [46] = {2,0}, [91] = {3,3}, 
            },
            [83] = {
                [18] = {1,0}, 
            },
            [82] = {
                [18] = {2,0}, 
            },
            [93] = {
                [44] = {1,0}, [22] = {1,3}, [19] = {1,0}, 
            },
            [88] = {
                [44] = {1,0}, [19] = {2,0}, [23] = {3,3}, 
            },
            [175] = {
                [73] = {4,0}, [74] = {3,0}, [53] = {1,3}, [46] = {2,0}, 
            },
            [67] = {
                [44] = {1,0}, [23] = {2,0}, [26] = {2,3}, 
            },
            [66] = {
                [64] = {0,2}, [66] = {0,1}, [60] = {0,2}, [62] = {0,2}, [78] = {0,2}, [56] = {0,2}, [44] = {2,0}, [84] = {0,1}, [53] = {0,1}, [80] = {0,2}, [57] = {0,1}, [79] = {0,2}, [82] = {0,1}, [81] = {0,1}, [70] = {0,1}, [68] = {0,2}, [69] = {0,2}, [65] = {0,1}, [67] = {0,1}, [61] = {0,1}, 
                [63] = {0,1}, [54] = {0,1}, [58] = {0,1}, [85] = {0,2}, [83] = {0,2}, [23] = {2,0}, [26] = {3,3}, [55] = {0,1}, [59] = {0,2}, 
            },
            [77] = {
                [18] = {2,0}, 
            },
            [72] = {
                [30] = {0,2}, [22] = {0,1}, [27] = {0,2}, [19] = {0,1}, [28] = {0,2}, [33] = {0,2}, [20] = {0,1}, [31] = {0,2}, [18] = {0,0}, [29] = {0,1}, [32] = {0,2}, [21] = {0,1}, 
            },
            [187] = {
                [74] = {2,0}, [102] = {2,0}, [54] = {0,3}, [75] = {2,3}, [47] = {3,0}, 
            },
            [51] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {2,0}, [71] = {3,0}, [93] = {3,0}, 
            },
            [50] = {
                [77] = {1,3}, [52] = {3,3}, [44] = {3,0}, [71] = {3,0}, [93] = {3,0}, 
            },
            [61] = {
                [77] = {2,3}, [52] = {3,3}, [44] = {3,0}, [71] = {1,0}, [93] = {2,0}, [23] = {2,0}, [26] = {2,3}, 
            },
            [56] = {
                [77] = {1,3}, [52] = {3,3}, [44] = {1,0}, [71] = {3,0}, [93] = {3,0}, 
            },
            [183] = {
                [76] = {3,3}, [90] = {1,0}, [74] = {2,0}, [102] = {2,0}, [53] = {2,3}, [47] = {2,0}, [91] = {2,3}, 
            },
            [35] = {
                [77] = {3,3}, [43] = {1,0}, [72] = {3,0}, [94] = {1,0}, [50] = {2,3}, 
            },
            [34] = {
                [77] = {2,3}, [43] = {3,0}, [72] = {2,0}, [94] = {2,0}, [50] = {2,3}, 
            },
            [45] = {
                [77] = {1,3}, [52] = {0,3}, [43] = {2,0}, [72] = {2,0}, [94] = {2,0}, 
            },
            [40] = {
                [77] = {3,3}, [43] = {2,0}, [72] = {3,0}, [94] = {1,0}, [50] = {3,3}, 
            },
            [196] = {
                [48] = {2,0}, [101] = {3,0}, [54] = {2,3}, [47] = {4,0}, 
            },
            [22] = {
                [94] = {3,0}, 
            },
            [24] = {
                [94] = {3,0}, 
            },
            [193] = {
                [102] = {2,0}, [54] = {2,3}, [47] = {3,0}, 
            },
            [204] = {
                [48] = {3,0}, [101] = {1,0}, [55] = {1,3}, 
            },
            [201] = {
                [48] = {1,0}, [101] = {2,0}, [55] = {3,3}, 
            },
            [212] = {
                [46] = {0,0}, [55] = {4,3}, [47] = {2,0}, 
            },
            [209] = {
                [55] = {3,3}, [47] = {3,0}, 
            },
            [217] = {
                [54] = {3,3}, [34] = {3,0}, 
            },
            [138] = {
                [45] = {1,0}, [54] = {1,3}, [85] = {2,0}, [31] = {2,3}, [18] = {3,0}, 
            },
            [142] = {
                [30] = {2,3}, [17] = {2,0}, [54] = {1,3}, [46] = {1,0}, [85] = {1,0}, 
            },
            [130] = {
                [54] = {2,3}, [46] = {3,0}, [31] = {2,3}, [18] = {3,0}, [91] = {2,0}, 
            },
            [134] = {
                [54] = {1,3}, [46] = {2,0}, [85] = {1,0}, [31] = {1,3}, [18] = {1,0}, 
            },
            [120] = {
                [56] = {1,3}, [30] = {0,3}, [27] = {0,2}, [28] = {0,1}, [25] = {0,1}, [46] = {1,0}, [26] = {0,2}, [18] = {2,0}, [92] = {2,0}, [29] = {0,2}, [24] = {0,1}, 
            },
            [19] = {
                [107] = {0,2}, [98] = {0,1}, [94] = {0,0}, [106] = {0,2}, [102] = {0,2}, [97] = {0,2}, [105] = {0,1}, [101] = {0,2}, [96] = {0,1}, [104] = {0,2}, [100] = {0,2}, [95] = {0,2}, [103] = {0,1}, [99] = {0,2}, 
            },
            [25] = {
                [44] = {0,1}, [48] = {0,2}, [43] = {0,0}, [94] = {3,0}, [45] = {0,2}, [49] = {0,3}, [46] = {0,1}, [47] = {0,2}, 
            },
            [123] = {
                [30] = {3,3}, [46] = {1,0}, [18] = {3,0}, [55] = {3,3}, [91] = {3,0}, 
            },
            [112] = {
                [74] = {1,3}, [97] = {3,0}, [71] = {2,0}, 
            },
            [115] = {
                [74] = {4,3}, [71] = {3,0}, [92] = {1,0}, 
            },
            [104] = {
                [44] = {1,0}, [98] = {4,2}, [94] = {4,1}, [102] = {1,0}, [57] = {3,3}, [97] = {4,2}, [93] = {4,2}, [71] = {3,0}, [101] = {4,1}, [75] = {2,3}, [96] = {4,2}, [92] = {4,1}, [100] = {4,1}, [95] = {4,2}, [91] = {4,0}, [99] = {4,1}, 
            },
            [107] = {
                [52] = {4,2}, [56] = {4,2}, [44] = {1,0}, [74] = {2,3}, [102] = {2,0}, [53] = {4,2}, [57] = {4,3}, [71] = {2,0}, [54] = {4,2}, [55] = {4,2}, [51] = {4,1}, 
            },
            [96] = {
                [44] = {3,0}, [22] = {3,3}, [19] = {2,0}, 
            },
            [99] = {
                [44] = {3,0}, [22] = {2,3}, [19] = {3,0}, 
            },
            [86] = {
                [38] = {4,2}, [30] = {4,0}, [35] = {4,1}, [19] = {1,0}, [36] = {4,2}, [41] = {4,1}, [33] = {4,2}, [39] = {4,2}, [42] = {4,1}, [31] = {4,2}, [34] = {4,2}, [23] = {3,3}, [37] = {4,1}, [40] = {4,2}, [32] = {4,1}, 
            },
            [178] = {
                [78] = {4,3}, [90] = {3,0}, [74] = {1,0}, [102] = {1,0}, [53] = {3,3}, [46] = {2,0}, [91] = {3,3}, 
            },
            [79] = {
                [18] = {3,0}, 
            },
            [92] = {
                [44] = {1,0}, [19] = {3,0}, [23] = {4,3}, 
            },
            [89] = {
                [44] = {2,0}, [19] = {3,0}, [23] = {3,3}, 
            },
            [70] = {
                [44] = {3,0}, [23] = {3,0}, [26] = {3,3}, 
            },
            [174] = {
                [73] = {3,0}, [74] = {3,0}, [53] = {3,3}, [46] = {3,0}, 
            },
            [63] = {
                [77] = {3,3}, [52] = {2,3}, [44] = {1,0}, [71] = {3,0}, [93] = {1,0}, [23] = {1,0}, [26] = {2,3}, 
            },
            [76] = {
                [18] = {2,0}, 
            },
            [73] = {
                [18] = {3,0}, 
            },
            [54] = {
                [77] = {2,3}, [52] = {2,3}, [44] = {2,0}, [71] = {1,0}, [93] = {2,0}, 
            },
            [186] = {
                [74] = {2,0}, [102] = {2,0}, [53] = {3,3}, [75] = {1,3}, [47] = {1,0}, 
            },
            [47] = {
                [77] = {1,3}, [52] = {2,3}, [44] = {1,0}, [94] = {1,0}, [71] = {0,0}, [93] = {0,0}, 
            },
            [60] = {
                [77] = {3,3}, [52] = {3,3}, [44] = {3,0}, [71] = {1,0}, [93] = {1,0}, [23] = {2,0}, [26] = {2,3}, 
            },
            [57] = {
                [77] = {2,3}, [52] = {3,3}, [44] = {3,0}, [71] = {2,0}, [93] = {3,0}, 
            },
            [38] = {
                [77] = {3,3}, [43] = {3,0}, [72] = {2,0}, [94] = {1,0}, [50] = {2,3}, 
            },
            [182] = {
                [76] = {2,3}, [90] = {1,0}, [74] = {2,0}, [102] = {3,0}, [53] = {3,3}, [47] = {2,0}, [91] = {2,3}, 
            },
            [31] = {
                [77] = {2,3}, [43] = {1,0}, [72] = {2,0}, [94] = {2,0}, [49] = {2,3}, 
            },
            [44] = {
                [77] = {1,3}, [43] = {3,0}, [72] = {1,0}, [94] = {3,0}, [51] = {1,3}, 
            },
            [41] = {
                [77] = {3,3}, [43] = {3,0}, [72] = {1,0}, [94] = {2,0}, [51] = {0,3}, 
            },
        }
    },
}

local STAGE_COLLISION = {
    ["BNoSpawn"] = {
        {38,214}, {38,212}, {38,210}, {38,208}, {38,206}, {38,204}, {38,202}, {38,200}, {38,198}, {38,196}, {38,194}, {38,192}, {38,190}, {130,184}, {130,182}, {130,180}, {130,178}, {130,176}, {130,174}, {130,172}, 
        {132,170}, {132,168}, {132,166}, {132,164}, {132,162}, {132,160}, {132,158}, {132,156}, {60,152}, {60,150}, {60,148}, {60,146}, {130,154}, {128,154}, {126,154}, {124,154}, {122,154}, {120,154}, {118,154}, {116,154}, 
        {114,154}, {112,154}, {110,154}, {108,154}, {106,154}, {104,154}, {102,154}, {100,154}, {98,154}, {96,154}, {94,154}, {92,154}, {90,154}, {88,154}, {86,154}, {84,154}, {82,154}, {80,154}, {78,154}, {76,154}, 
        {74,154}, {72,154}, {70,154}, {68,154}, {66,154}, {64,154}, {62,154}, {60,154}, {132,140}, {132,138}, {132,136}, {132,134}, {132,132}, {132,130}, {132,128}, {132,126}, {132,124}, {132,122}, {132,120}, {132,118}, 
        {132,116}, {132,114}, {132,112}, {132,110}, {132,108}, {132,106}, {130,104}, {128,104}, {126,104}, {124,104}, {122,104}, {120,104}, {118,104}, {116,104}, {114,104}, {112,104}, {110,104}, {108,104}, {106,104}, {104,104}, 
        {102,104}, {100,104}, {98,104}, {96,104}, {94,104}, {92,104}, {90,104}, {88,102}, {86,102}, {84,102}, {82,102}, {80,100}, {78,100}, {76,100}, {74,100}, {72,100}, {70,100}, {68,100}, {66,100}, {64,98}, 
        {62,98}, {60,98}, {58,98}, {56,98}, {54,98}, {52,98}, {50,98}, {50,96}, {50,94}, {50,92}, {50,90}, {50,88}, {316,54}, {316,52}, {316,50}, {316,48}, {316,46}, {316,44}, {316,42}, {316,40}, 
        {316,38}, {316,36}, {314,56}, {314,58}, {312,58}, {310,58}, {308,58}, {306,58}, {304,58}, {302,58}, {300,58}, {298,60}, {296,60}, {294,60}, {292,60}, {290,60}, {288,60}, {286,60}, {284,60}, {282,62}, 
        {280,62}, {278,62}, {276,62}, {274,62}, {272,62}, {270,62}, {268,62}, {266,62}, {264,62}, {262,62}, {260,62}, {258,62}, {256,62}, {254,60}, {252,60}, {250,60}, {248,60}, {246,60}, {244,60}, {242,60}, 
        {240,60}, {240,58}, {240,56}, {240,54}, {240,52}, {240,50}, {240,48}, {238,46}, {238,44}, {238,42}, {238,40}, {238,38}, {142,86}, {142,84}, {142,82}, {142,80}, {142,78}, {142,76}, {142,74}, {142,72}, 
        {142,70}, {142,68}, {144,66}, {144,64}, {144,62}, {144,60}, {144,58}, {144,56}, {144,54}, {118,50}, {118,48}, {142,52}, {140,52}, {138,52}, {136,52}, {134,52}, {132,52}, {130,52}, {128,52}, {126,52}, 
        {124,52}, {122,52}, {120,52}, {118,52}, {202,42}, {202,40}, {202,44}, {200,44}, {198,44}, {196,44}, {194,44}, {192,44}, {190,44}, {188,44}, {186,44}, {184,46}, {182,46}, {180,46}, {178,46}, {176,46}, 
        {174,46}, {172,46}, {144,44}, {144,42}, {144,40}, {144,38}, {170,58}, {170,56}, {170,54}, {170,52}, {170,50}, {170,48}, {172,84}, {172,82}, {172,80}, {172,78}, {172,76}, {172,74}, {172,72}, {172,70}, 
        {172,68}, {172,66}, {172,64}, {172,62}, {172,60}, {174,86}, {434,68}, {432,68}, {430,82}, {430,80}, {430,78}, {430,76}, {430,74}, {430,72}, {430,70}, {430,68}, {428,84}, {426,90}, {426,88}, {426,86}, 
        {426,84}, {424,92}, {434,108}, {432,108}, {430,108}, {428,108}, {426,108}, {424,110}, {422,110}, {420,110}, {418,110}, {416,110}, {414,110}, {412,110}, {410,110}, {408,110}, {406,110}, {404,110}, {402,110}, {400,110}, 
        {398,108}, {396,108}, {394,108}, {392,108}, {390,108}, {388,108}, {386,108}, {384,108}, {382,108}, {380,108}, {378,108}, {376,108}, {374,108}, {372,106}, {370,106}, {368,106}, {366,106}, {364,106}, {362,106}, {360,106}, 
        {358,106}, {356,106}, {354,106}, {352,106}, {350,106}, {348,106}, {346,106}, {344,108}, {342,108}, {340,108}, {338,108}, {336,108}, {334,108}, {332,108}, {330,106}, {328,106}, {326,106}, {324,106}, {322,106}, {320,106}, 
        {318,106}, {316,106}, {314,106}, {312,106}, {310,106}, {308,106}, {306,106}, {304,106}, {302,106}, {300,106}, {298,106}, {296,108}, {294,108}, {292,108}, {290,108}, {288,108}, {286,108}, {284,108}, {282,108}, {280,108}, 
        {278,108}, {276,108}, {274,108}, {272,108}, {270,108}, {268,108}, {266,108}, {264,108}, {262,108}, {260,108}, {258,110}, {256,110}, {254,110}, {252,110}, {250,110}, {248,110}, {246,110}, {244,112}, {242,112}, {240,112}, 
        {238,112}, {238,110}, {238,108}, {238,106}, {238,104}, {238,102}, {238,100}, {238,98}, {238,96}, {238,94}, {216,100}, {216,98}, {216,96}, {216,94}, {216,92}, {216,90}, {214,112}, {214,110}, {214,108}, {214,106}, 
        {214,104}, {214,102}, {214,114}, {212,114}, {210,114}, {208,114}, {206,114}, {204,140}, {204,138}, {204,136}, {204,134}, {204,132}, {204,130}, {204,128}, {204,126}, {204,124}, {204,122}, {204,120}, {204,118}, {204,116}, 
        {412,214}, {412,212}, {412,210}, {412,208}, {412,206}, {412,204}, {232,146}, {238,146}, {238,144}, {236,146}, {234,146}, {230,148}, {228,148}, {226,148}, {224,148}, {222,148}, {220,148}, {218,148}, {216,148}, {214,148}, 
        {212,150}, {210,150}, {208,150}, {206,150}, {204,162}, {204,160}, {204,158}, {204,156}, {204,154}, {204,152}, {206,180}, {206,178}, {206,176}, {206,174}, {206,172}, {206,170}, {206,168}, {206,166}, {206,164}, {208,202}, 
        {208,200}, {208,198}, {208,196}, {208,194}, {208,192}, {208,190}, {208,188}, {208,186}, {208,184}, {208,182}, {216,204}, {214,204}, {212,204}, {210,204}, {218,202}, {218,200}, {218,198}, {218,196}, {218,194}, {224,194}, 
        {222,194}, {220,194}, {226,192}, {226,190}, {226,188}, {226,186}, {262,180}, {262,178}, {262,176}, {262,174}, {262,172}, {324,166}, {324,164}, {324,162}, {324,160}, {324,158}, {324,156}, {324,154}, {324,152}, {324,150}, 
        {382,150}, {380,150}, {378,150}, {376,150}, {374,150}, {372,150}, {370,152}, {368,152}, {366,152}, {364,152}, {362,152}, {360,154}, {358,154}, {356,156}, {354,178}, {354,176}, {354,174}, {354,172}, {354,170}, {354,168}, 
        {354,166}, {354,164}, {354,162}, {354,160}, {354,158}, {370,182}, {368,182}, {366,182}, {364,182}, {362,182}, {360,182}, {358,182}, {356,182}, {354,202}, {354,200}, {354,198}, {354,196}, {354,194}, {354,192}, {354,190}, 
        {354,188}, {354,186}, {354,184}, 
    },
    ["B"] = {
        {412,202}, {410,202}, {408,202}, {406,202}, {404,202}, {402,202}, {400,202}, {398,202}, {396,202}, {394,202}, {392,202}, {390,202}, {388,202}, {386,204}, {384,204}, {382,204}, {380,204}, {378,204}, {376,204}, {374,204}, 
        {372,204}, {370,204}, {368,204}, {366,204}, {364,204}, {362,204}, {360,204}, {358,204}, {356,204}, {370,180}, {368,180}, {366,180}, {364,180}, {362,180}, {360,180}, {358,180}, {356,180}, {326,148}, {324,148}, {382,148}, 
        {380,148}, {378,148}, {376,148}, {374,148}, {372,148}, {370,148}, {368,148}, {366,148}, {364,148}, {362,148}, {360,148}, {358,148}, {356,148}, {354,148}, {352,148}, {350,146}, {348,146}, {346,146}, {344,146}, {342,146}, 
        {340,146}, {338,146}, {336,146}, {334,146}, {332,146}, {330,146}, {328,146}, {322,168}, {320,168}, {318,168}, {316,168}, {314,168}, {312,168}, {310,168}, {308,168}, {306,168}, {304,168}, {302,168}, {300,168}, {298,168}, 
        {296,168}, {294,168}, {292,168}, {290,168}, {240,184}, {238,184}, {236,184}, {234,184}, {232,184}, {230,184}, {228,184}, {226,184}, {260,182}, {258,182}, {256,182}, {254,182}, {252,182}, {250,182}, {248,182}, {246,182}, 
        {244,182}, {242,182}, {288,170}, {286,170}, {284,170}, {282,170}, {280,170}, {278,170}, {276,170}, {274,170}, {272,170}, {270,170}, {268,170}, {266,170}, {264,170}, {262,170}, {238,142}, {236,142}, {234,142}, {232,142}, 
        {230,142}, {228,142}, {226,142}, {224,142}, {222,142}, {220,142}, {218,142}, {216,142}, {214,142}, {212,142}, {210,142}, {208,142}, {206,142}, {128,186}, {126,186}, {124,186}, {122,186}, {120,186}, {118,186}, {116,186}, 
        {114,186}, {112,186}, {110,186}, {108,186}, {106,186}, {104,186}, {102,186}, {100,186}, {98,186}, {96,186}, {94,186}, {92,188}, {90,188}, {88,188}, {86,188}, {84,188}, {82,188}, {80,188}, {78,188}, {76,188}, 
        {74,188}, {72,188}, {70,188}, {68,188}, {66,188}, {64,188}, {62,188}, {60,188}, {58,188}, {56,188}, {54,188}, {52,188}, {50,188}, {48,188}, {46,188}, {44,188}, {42,188}, {40,188}, {38,188}, {92,144}, 
        {90,144}, {88,144}, {86,144}, {84,144}, {82,144}, {80,144}, {78,144}, {76,144}, {74,144}, {72,144}, {70,144}, {68,144}, {66,144}, {64,144}, {62,144}, {60,144}, {130,142}, {128,142}, {126,142}, {124,142}, 
        {122,142}, {120,142}, {118,142}, {116,142}, {114,142}, {112,142}, {110,142}, {108,142}, {106,142}, {104,142}, {102,142}, {100,142}, {98,142}, {96,142}, {94,142}, {314,34}, {312,34}, {310,34}, {308,34}, {306,34}, 
        {304,34}, {302,34}, {300,34}, {298,34}, {296,34}, {294,34}, {292,34}, {290,34}, {288,34}, {286,34}, {284,34}, {282,34}, {280,34}, {278,36}, {276,36}, {274,36}, {272,36}, {270,36}, {268,36}, {266,36}, 
        {264,36}, {262,36}, {260,36}, {258,36}, {256,36}, {254,36}, {252,36}, {250,36}, {248,36}, {246,36}, {244,36}, {242,36}, {240,36}, {238,36}, {140,88}, {138,88}, {136,88}, {134,88}, {132,88}, {130,88}, 
        {128,88}, {126,88}, {124,88}, {122,88}, {120,88}, {118,88}, {116,88}, {114,88}, {112,88}, {110,88}, {108,88}, {106,88}, {104,88}, {102,88}, {100,88}, {98,88}, {96,88}, {94,88}, {92,88}, {90,86}, 
        {88,86}, {86,86}, {84,86}, {82,86}, {80,86}, {78,86}, {76,86}, {74,86}, {72,86}, {70,86}, {68,86}, {66,86}, {64,86}, {62,86}, {60,86}, {58,86}, {56,86}, {54,86}, {52,86}, {50,86}, 
        {142,46}, {140,46}, {138,46}, {136,46}, {134,46}, {132,46}, {130,46}, {128,46}, {126,46}, {124,46}, {122,46}, {120,46}, {118,46}, {170,36}, {168,36}, {166,36}, {164,36}, {162,36}, {160,36}, {158,36}, 
        {156,36}, {154,36}, {152,36}, {150,36}, {148,36}, {146,36}, {144,36}, {202,38}, {200,38}, {198,38}, {196,38}, {194,38}, {192,38}, {190,38}, {188,38}, {186,38}, {184,38}, {182,38}, {180,38}, {178,38}, 
        {176,38}, {174,38}, {172,38}, {216,88}, {214,88}, {212,88}, {210,88}, {208,88}, {206,88}, {204,88}, {202,88}, {200,88}, {198,88}, {196,88}, {194,88}, {192,88}, {190,88}, {188,88}, {186,88}, {184,88}, 
        {182,88}, {180,88}, {178,88}, {176,88}, {268,92}, {266,92}, {264,92}, {262,92}, {260,92}, {258,92}, {256,92}, {254,92}, {252,92}, {250,92}, {248,92}, {246,92}, {244,92}, {242,92}, {240,92}, {238,92}, 
        {282,90}, {280,90}, {278,90}, {276,90}, {274,90}, {272,90}, {270,90}, {316,92}, {314,92}, {312,92}, {310,92}, {308,92}, {306,92}, {304,92}, {302,92}, {300,92}, {298,92}, {296,92}, {294,92}, {292,92}, 
        {290,92}, {288,92}, {286,92}, {284,92}, {334,90}, {332,90}, {330,90}, {328,90}, {326,90}, {324,90}, {322,90}, {320,90}, {318,90}, {360,92}, {358,92}, {356,92}, {354,92}, {352,92}, {350,92}, {348,92}, 
        {346,92}, {344,92}, {342,92}, {340,92}, {338,92}, {336,92}, {392,94}, {390,94}, {388,94}, {386,94}, {384,94}, {382,94}, {380,94}, {378,94}, {376,94}, {374,94}, {372,94}, {370,94}, {368,94}, {366,94}, 
        {364,94}, {362,94}, {414,96}, {412,96}, {410,96}, {408,96}, {406,96}, {404,96}, {402,96}, {400,96}, {398,96}, {396,96}, {394,96}, {422,94}, {420,94}, {418,94}, {416,94}, 
    },
}

local STAGE_OBJECTS = {
    {
        "Geyser", "Vanilla",
        {
            {340,146}, {213,204}, {321,168}, {360,180}, 
        }
    },
    {
        "GeyserWeak", "Vanilla",
        {
            {259,182}, 
        }
    },
    {
        "Water", "Vanilla",
        {
            {316,-145}, 
        }
    },
}

local STAGE_BACKGROUNDS = {
}

local STAGE_INTERACTABLES = {
}

local STAGE_ENEMIES = {
}

-- LEVEL DATA END --
local function r(t,n,o)local q=_G[t].find(n,o)return q or error("Failed to resolve "..n..":"..o.. " ("..t.."), make sure all resources are loaded before loading the stage.") end

local function mkObjs()
    local bg = Object("PELDR_BG")
    local ts = Object("PELDR_TS")
	local c = camera
	local x,y,w,h=0,0,0,0
    callback("onCameraUpdate", function() if bg:find(1) or ts:find(1) then x,y,w,h=camera.x,camera.y,camera.width,camera.height end end, -100)
    local z = {}
    callback("globalRoomEnd", function(r)
        for k, _ in pairs(z) do
            if Surface.isValid(k) then
                k:free()
            end
        end
    end, -100)
    
    local di,st,rst = graphics.drawImage,graphics.setTarget,graphics.resetTarget
    local function chnk(s, ts, x, y, o)
        local r = {0, 0, 16, 16}
        local d = {image = s, x = 0, y = 0, region = r}
        local sf = Surface(512, 512)
        st(sf)
        local w
        for _x = x / 16, (x + 512) / 16 do
            local q = ts[_x]
            if q ~= nil then
                for _y = y / 16, (y + 512) / 16 do
                    local t = q[_y]
                    if t ~= nil then
                        r[1] = t[1] * 16 + (o or (t[1] + 1))
                        r[2] = t[2] * 16 + (o or (t[2] + 1))
                        d.x = _x * 16 - x
                        d.y = _y * 16 - y
                        w = 1
                        di(d)
                    end
                end
            end
        end
        rst()
        if not w then
            sf:free()
            return 0
        else
            z[sf] = 1
            return sf
        end
    end
    local mf,mc = math.floor, math.ceil
    local vld = Surface.isValid
	ts:addCallback("draw", function(i)
		local d=i:getModData("PELDR")
        local c = d.c
        for X = mf(x / 512), mc((x + w) / 512) do
            local q = c[X]
            if q == nil then
                q = {}
                c[X] = {}
            end
            for Y = mf(y / 512), mc((y + h) / 512) do
                local cc = q[Y]
                if cc ~= 0 and not vld(cc) then
                    if cc ~= nil then
                        z[cc] = nil
                    end
                    cc = chnk(d.s, d.t, X * 512, Y * 512,d.g or 0)
                    q[Y] = cc
                end
                if cc ~= 0 then
                    cc:draw(X * 512, Y * 512)
                end
            end
        end
	end)
    
	bg:addCallback("draw", function(i)
		local d=i:getModData("PELDR")
		local s=d.s
		
		local fx,fy=d.x+x*d.px+w*d.xo,d.y+y*d.py+h*d.yo

		local sw,x1,x2=1,fx,fx
		if d.hr then
			sw = s.width
			x1 = x1 % sw + x - x % sw - sw
			x2 = x + w
		end

		local sh,y1,y2=1,fy,fy
		if d.vr then
			sh=s.height
			y1 = y1 % sh + y - y % sh - sh
			y2=y + h
		end

		for X=x1,x2,sw do for Y=y1,y2,sh do s:draw(X,Y)end end
	end)
	return ts,bg
end
local ts,bg=Object.find("PELDR_TS"),Object.find("PELDR_BG")
if ts == nil then ts,bg=mkObjs()end

local function spawnBG(sprite, depth, x, y, hrepeat, vrepeat, xparallax, yparallax, xpercentoffs, ypercentoffs)
	local i=bg:create(0,0)
	d=i:getModData("PELDR")
	i.depth = depth
	d.s = sprite
	d.x = x
	d.y = y
	d.hr = hrepeat
	d.vr = vrepeat
	d.px = xparallax
	d.py = yparallax
	d.xo = xpercentoffs
	d.yo = ypercentoffs
end

local function spawnTS(sprite, depth, tiles, grid)
	local i=ts:create(0,0)
	d=i:getModData("PELDR")
    i.depth = depth
    d.c = {}
    d.s = sprite
    d.g = grid
    d.t = tiles
end

local room = Room.new(STAGE_INFO.name)
room:resize(STAGE_INFO.width, STAGE_INFO.height)
for col, coordlist in pairs(STAGE_COLLISION) do
	local obj = Object.find(col, "Vanilla")
	for _, coords in ipairs(coordlist) do
        room:createInstance(obj, coords[1]*8, coords[2]*8)
    end
end
for _, objectlist in ipairs(STAGE_OBJECTS) do
	local obj = r("Object", objectlist[1], objectlist[2])
	for _, coords in ipairs(objectlist[3]) do
		room:createInstance(obj, coords[1]*8, coords[2]*8)
	end
end

local stage = Stage.new(STAGE_INFO.name)
stage.subname = STAGE_INFO.subname
stage.rooms:add(room)
stage.music = Sound.find(STAGE_INFO.music) or Sound.find("MusicStage1")

for _, i in ipairs(STAGE_INTERACTABLES) do
    stage.interactables:add(r("Interactable", i[1], i[2]))
end
for _, e in ipairs(STAGE_ENEMIES) do
    stage.enemies:add(r("MonsterCard", e[1], e[2]))
end

local bgs = {}
for k, v in pairs(STAGE_BACKGROUNDS) do
    table.insert(bgs, {r("Sprite", v[1], v[2]), k, v[7], v[8], v[3]==1, v[4]==1, v[5], v[6], v[9], v[10]})
end
local lrs = {}
for _, v in ipairs(STAGE_LAYERS) do
    table.insert(lrs, {r("Sprite", v.sprite, v.origin), v.depth, v.tiles, v.grid})
end
local function mrgcol(o)
    for _, v in ipairs(o:findAll()) do
        v.xscale = 1 / 16
    end
    local c
    repeat
        c = 0
        for _, v in ipairs(o:findAll()) do
            if v:isValid() and v.xscale < 1 then
                local s = o:findPoint(v:get("bbox_right") + 16, v.y)
                if s and s.xscale < 1 then
                    c = 1
                    v.xscale = v.xscale + s.xscale
                    s:destroy()
                end
            end
        end
    until c == 0
end
local bs = Object.find("bossSpawn","vanilla")
local bs2 = Object.find("bossSpawn2","vanilla")
callback("globalRoomStart", function(r)
    if r == room then
        for _, v in ipairs(bgs) do
            spawnBG(table.unpack(v))
        end
        for _, v in ipairs(lrs) do
            spawnTS(table.unpack(v))
        end
        mrgcol(bs)
        mrgcol(bs2)
    end
end)


return stage